<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Decap CMS</title>
  </head>
  <body>
    <!-- Load Decap CMS from the UNPKG CDN -->
    <script>
      (function () {
        const LOG_PREFIX = '[Decap OAuth]';
        console.info(`${LOG_PREFIX} Waiting for GitHub authorization messages...`);

        window.addEventListener('message', (event) => {
          if (typeof event.data !== 'string') {
            return;
          }

          if (event.data.startsWith('authorization:github:success:')) {
            try {
              const payloadText = event.data.substring('authorization:github:success:'.length);
              const payload = JSON.parse(payloadText);
              const { state, validatedState, ...rest } = payload;
              console.info(
                `${LOG_PREFIX} Received GitHub authorization payload.`,
                rest,
                state ? { state } : undefined,
                validatedState ? { validatedState } : undefined,
              );
            } catch (parseError) {
              console.error(`${LOG_PREFIX} Failed to parse GitHub authorization payload.`, parseError);
            }
          }
        });
      })();
    </script>
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  </body>
</html>
